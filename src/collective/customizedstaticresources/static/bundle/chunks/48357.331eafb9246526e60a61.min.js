"use strict";(self.webpackChunkplone_staticresources=self.webpackChunkplone_staticresources||[]).push([[48357],{48357:function(t,e,n){n.r(e),n.d(e,{default:function(){return E}});var i=n(71553),a=n(44563),l=n(59329),o=n(35686),r=n.n(o),s=n(40705),c=n.n(s),m=n(75199),p=n.n(m),d=(n(10906),n(53902),'<?xml version="1.0" encoding="utf-8"?>\n<div>\n  <div class="linkModal">\n    <h1 /></div></div>\n'),h='<?xml version="1.0" encoding="utf-8"?>\n<div>\n  <div class="linkModal">\n    <h1 /></div></div>\n',g=i.A.extend({name:"linktype",trigger:".pat-linktype-dummy",defaults:{linkModal:null},init:function(){this.linkModal=this.options.linkModal,this.tinypattern=this.options.tinypattern,this.tiny=this.tinypattern.tiny,this.dom=this.tiny.dom},getEl:function(){return this.el.querySelector("input")},value:function(){return this.getEl().value.trim()},toUrl:function(){return this.value()},load:function(t){let e=this.tiny.dom.getAttrib(t,"data-val");this.set(e)},set:function(t){this.getEl().setAttribute("value",t)},attributes:function(){return{"data-val":this.value()}},updateRelatedItems:function(){}}),u=g.extend({name:"externallinktype",trigger:".pat-externallinktype-dummy",init:function(){g.prototype.init.call(this),this.getEl().addEventListener("change",function(){var t=r()(this).val();new RegExp("https?://").test(t)||-1!==r()(this).val().split("/")[0].indexOf(".")&&r()(this).val("http://"+t)})},load:function(t){let e=this.tiny.dom.getAttrib(t,"data-val");this.set(e)}}),y=g.extend({name:"internallinktype",trigger:".pat-internallinktype-dummy",init:async function(){this.getEl()&&(g.prototype.init.call(this),await this.createContentBrowser())},getEl:function(){return this.el.querySelector("input")},createContentBrowser:async function(){var t={selection:[],...this.linkModal.options?.relatedItems};t["maximum-selection-size"]=1,t.upload=1;const e=this.getEl(),i=this.tiny.selection.getNode(),a=this.tiny.dom.getAttrib(i,"data-linktype");"internal"!==a&&"image"!==a||t.selection.push(this.tiny.dom.getAttrib(i,"data-val"));const l=(await Promise.resolve().then(n.bind(n,306))).default;this.contentBrowserPattern=new l(e,t)},toUrl:function(){var t=this.value();return t?this.tinypattern.generateUrl(t):null}}),k=g.extend({name:"uploadlinktype",trigger:".pat-uploadlinktype-dummy",getDelegatedLinkType:function(){return"uploadImage"===this.linkModal.linkType?this.linkModal.linkTypes.image:this.linkModal.linkTypes.internal},toUrl:function(){return this.getDelegatedLinkType().toUrl()},attributes:function(){return this.getDelegatedLinkType().attributes()},set:function(t){return this.getDelegatedLinkType().set(t)},load:function(t){return this.getDelegatedLinkType().load(t)},value:function(){return this.getDelegatedLinkType().value()}}),f=y.extend({name:"imagelinktype",trigger:".pat-imagelinktype-dummy",toUrl:function(){var t=this.value();return this.tinypattern.generateImageUrl(t,this.linkModal.getScaleFromSrcset(this.linkModal.$scale.val()))}}),x=g.extend({name:"emaillinktype",trigger:".pat-emaillinktype-dummy",toUrl:function(){var t=this.value();if(t){var e=this.getSubject(),n="mailto:"+t;return e&&(n+="?subject="+e),n}return null},load:function(t){g.prototype.load.apply(this,[t]),this.linkModal.$subject.val(this.tiny.dom.getAttrib(t,"data-subject"))},getSubject:function(){return this.linkModal.$subject.val()},attributes:function(){var t=g.prototype.attributes.call(this);return t["data-subject"]=this.getSubject(),t}}),v=g.extend({name:"anchorlinktype",trigger:".pat-anchorlinktype-dummy",init:function(){g.prototype.init.call(this),this.$select=this.$el.find("select"),this.anchorNodes=[],this.anchorData=[],this.populate()},value:function(){var t=this.$select.select2("data");return t&&"object"==typeof t&&(t=t.id),t},populate:function(){var t,e,n,i,a,l=this;l.$select.find("option").remove(),l.anchorNodes=[],l.anchorData=[];var o=l.tiny.dom.select(".mceItemAnchor,.mce-item-anchor");for(e=0;e<o.length;e+=1)t=o[e],(i=l.tiny.dom.getAttrib(t,"name"))||(i=l.tiny.dom.getAttrib(t,"id")),""!==i&&(l.anchorNodes.push(t),l.anchorData.push({name:i,title:i}));if((o=l.tiny.dom.select(l.linkModal.options.anchorSelector)).length>0)for(e=0;e<o.length;e+=1)if(t=o[e],""!==(a=r()(t).text().replace(/^\s+|\s+$/g,""))){i=(i=a.toLowerCase().substring(0,1024)).replace(/[^a-z0-9]/g,"-");var s=!1;for(n=0;n<l.anchorNodes.length;n+=1){var c=l.anchorData[n];if(c.name===i){s=!0,c.title=a;break}}s||(l.anchorData.push({name:i,title:a,newAnchor:!0}),l.anchorNodes.push(t))}if(l.anchorNodes.length>0)for(e=0;e<l.anchorData.length;e+=1){var m=l.anchorData[e];l.$select.append('<option value="'+e+'">'+m.title+"</option>")}else l.$select.append("<option>No anchors found..</option>")},getIndex:function(t){for(var e=0;e<this.anchorData.length;e+=1){if(this.anchorData[e].name===t)return e}return 0},toUrl:function(){var t=this.value();if(t){var e=parseInt(t,10),n=this.anchorNodes[e],i=this.anchorData[e];return i.newAnchor&&(n.innerHTML='<a name="'+i.name+'" class="mce-item-anchor"></a>'+n.innerHTML),"#"+i.name}return null},set:function(t){var e=this.getIndex(t);this.$select.select2("data",""+e)}});const T=t=>{document.getElementById(t.id.replace("-editable",""))["pattern-tinymce"].instance.addImageClicked()},b=t=>{document.getElementById(t.id.replace("-editable",""))["pattern-tinymce"].instance.addLinkClicked()};p().PluginManager.add("ploneimage",(t,e)=>{t.ui.registry.addButton("ploneimage",{icon:"image",text:"Insert image",tooltip:"Insert/edit image",onAction:()=>{T(t)}}),t.ui.registry.addMenuItem("ploneimage",{icon:"image",text:"Insert image",onAction:()=>{T(t)}})}),p().PluginManager.add("plonelink",function(t,e){t.ui.registry.addButton("plonelink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onAction:()=>{b(t)},stateSelector:"a[href]"}),t.ui.registry.addMenuItem("plonelink",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onAction:()=>{b(t)},stateSelector:"a[href]"}),t.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:e=>{t.execCommand("unlink")},stateSelector:"a[href]"})});var E=i.A.extend({name:"linkmodal",trigger:".pat-linkmodal",defaults:{anchorSelector:"h1,h2,h3",linkTypes:[],initialLinkType:"internal",text:{insertHeading:"Insert Link"},linkTypeClassMapping:{internal:y,upload:k,external:u,email:x,anchor:v,image:f,uploadImage:k,externalImage:g}},linkTypeTemplateMapping:{internal:h,upload:h,external:h,email:h,anchor:h,image:d,uploadImage:d,externalImage:d},template:function(t){return c().template(this.linkTypeTemplateMapping[this.linkType])(t)},init:function(){var t=this;t.tinypattern=t.options.tinypattern,t.tinypattern.options.anchorSelector&&(t.options.anchorSelector=t.tinypattern.options.anchorSelector),t.tiny=t.tinypattern.tiny,t.dom=t.tiny.dom,t.linkType=t.options.initialLinkType,t.linkTypes={},t.modal=l.A.patterns["plone-modal"].init(t.$el,{html:t.generateModalHtml(),content:null,buttons:".plone-btn",reloadWindowOnClose:!1,templateOptions:{classDialog:"modal-dialog modal-lg",reloadWindowOnClose:!1},actionOptions:{reloadWindowOnClose:!1},backdropOptions:{zIndex:"1340",closeOnClick:!1}}),t.modal.on("shown",e=>{t.modalShown.apply(t,[e])})},isOnlyTextSelected:function(){var t=this.tiny.selection.getContent();if(/</.test(t)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(t)||-1===t.indexOf("href=")))return!1;if(this.anchorElm){var e=this.anchorElm.childNodes;if(0===e.length)return!1;for(var n=e.length-1;n>=0;n--)if(3!==e[n].nodeType)return!1}return!0},generateModalHtml:function(){return this.template({options:this.options,upload:this.options.upload,text:this.options.text,insertHeading:this.options.text.insertHeading,insertImageHelp:this.options.text.insertImageHelp,uploadText:this.options.text.upload,insertLinkHelp:this.options.text.insertLinkHelp,internal:this.options.text.internal,external:this.options.text.external,anchor:this.options.text.anchor,anchorLabel:this.options.text.anchorLabel,target:this.options.text.target,linkTypes:this.options.linkTypes,externalText:this.options.text.externalText,emailText:this.options.text.email,subjectText:this.options.text.subject,targetList:this.options.targetList,titleText:this.options.text.title,internalImageText:this.options.text.internalImage,externalImage:this.options.text.externalImage,externalImageText:this.options.text.externalImageText,altText:this.options.text.alt,imageAlignText:this.options.text.imageAlign,captionFromDescriptionText:this.options.text.captionFromDescription,enableImageZoom:this.options.text.enableImageZoom,captionText:this.options.text.caption,scaleText:this.options.text.scale,pictureVariants:this.options.pictureVariants,imageCaptioningEnabled:this.options.imageCaptioningEnabled,cancelBtn:this.options.text.cancelBtn,insertBtn:this.options.text.insertBtn})},isImageMode:function(){return-1!==["image","uploadImage","externalImage"].indexOf(this.linkType)},initElements:async function(){var t=this;t.$target=r()('select[name="target"]',t.modal.$modal),t.$button=r()('.modal-footer input[name="insert"]',t.modal.$modal),t.$title=r()('input[name="title"]',t.modal.$modal),t.$subject=r()('input[name="subject"]',t.modal.$modal),t.$alt=r()('input[name="alt"]',t.modal.$modal),t.$align=r()('select[name="align"]',t.modal.$modal),t.$scale=r()('select[name="scale"]',t.modal.$modal),t.$selectedItems=r()("input.pat-contentbrowser",t.modal.$modal),t.$enableImageZoom=r()('input[name="enableImageZoom"]',t.modal.$modal),t.$captionFromDescription=r()('input[name="captionFromDescription"]',t.modal.$modal),t.$caption=r()('textarea[name="caption"]',t.modal.$modal);for(var e=0;e<t.options.linkTypes.length;e++){var n=t.options.linkTypes[e],i=r()(".linkType."+n+" .main",t.modal.$modal);if(i.length){var l=new t.options.linkTypeClassMapping[n](i,{linkModal:t,tinypattern:t.tinypattern});await a.A.await_pattern_init(l),t.linkTypes[n]=l}}r()(".autotoc-nav a",t.modal.$modal).on("click",function(){var e=r()("fieldset.linkType",t.modal.$modal).eq(r()(this).index())[0].className.split(/\s+/);c().each(e,function(e){-1!==c().indexOf(t.options.linkTypes,e)&&(t.linkType=e)})}),t.$captionFromDescription.on("change",function(){this.checked?t.$caption.prop("disabled",!0):t.$caption.prop("disabled",!1)})},getLinkUrl:function(){return this.linkTypes[this.linkType].toUrl()},getValue:function(){return this.linkTypes[this.linkType].value()},updateAnchor:function(t){var e=this;e.tiny.focus(),e.tiny.selection.setRng(e.rng);var n=e.$target.val(),i=e.$title.val(),a=r().extend(!0,e.data,{title:i||null,target:n||null,"data-linkType":e.linkType,href:t},e.linkTypes[e.linkType].attributes());e.anchorElm?(e.onlyText&&a.text!==e.initialText&&("innerText"in e.anchorElm?e.anchorElm.innerText=e.data.text:e.anchorElm.textContent=e.data.text),e.tiny.dom.setAttribs(e.anchorElm,a),e.tiny.selection.select(e.anchorElm),e.tiny.undoManager.add()):e.onlyText?e.tiny.insertContent(e.tiny.dom.createHTML("a",a,e.tiny.dom.encode(e.data.text))):e.tiny.execCommand("mceInsertLink",!1,a)},focusElement:function(t){this.tiny.focus(),this.tiny.selection.select(t),this.tiny.nodeChanged()},getScaleFromSrcset:function(t){let e=this.options.pictureVariants[t];return e.sourceset[e.sourceset.length-1].scale},updateImage:function(t){console.log(`updateImage: ${t}`);var e=this,n=e.$title.val(),i=e.$captionFromDescription.prop("checked"),a=e.$enableImageZoom.prop("checked"),l=e.$caption.val();e.tiny.focus(),e.tiny.selection.setRng(e.rng);var o=["image-richtext"];e.$align.val()&&o.push(e.$align.val()),"externalImage"!==e.linkType&&o.push("picture-variant-"+e.$scale.val()),(i||l)&&o.push("captioned"),a&&o.push("zoomable");var r={src:t,title:n||null,alt:e.$alt.val(),class:o.join(" "),"data-linkType":e.linkType,"data-scale":e.getScaleFromSrcset(e.$scale.val()),...e.linkTypes[e.linkType].attributes()};if("externalImage"!==e.linkType&&(r["data-picturevariant"]=e.$scale.val()),l&&!i&&(r["data-captiontext"]=l),e.imgElm&&!e.imgElm.getAttribute("data-mce-object")){const t=e.dom.getAttrib(e.imgElm,"width"),n=e.dom.getAttrib(e.imgElm,"height");t&&(r.width=t),n&&(r.height=n)}else e.imgElm=null;var s,c=e.dom.create("img",r);e.imgElm&&"img"==e.imgElm.tagName.toLowerCase()?e.imgElm.replaceWith(c):e.rng.insertNode(c),e.imgElm=c,(s=e.imgElm).onload=s.onerror=function(){s.onload=s.onerror=null,e.focusElement(s)},e.imgElm.complete&&e.focusElement(e.imgElm)},modalShown:async function(t){var e=this;await e.initElements(),e.initData(),e.$button.off("click").on("click",function(t){var n;t.preventDefault(),t.stopPropagation(),e.linkType=e.modal.$modal.find("fieldset.active").data("linktype");try{n=e.getLinkUrl()}catch(t){return void console.log(t)}n&&(e.isImageMode()?e.updateImage(n):e.updateAnchor(n),e.hide())}),r()('.modal-footer input[name="cancel"]',e.modal.$modal).on("click",function(t){t.preventDefault(),e.hide()})},show:function(){this.modal.show()},hide:function(){this.modal.hide()},initData:function(){var t,e,n=this;if(n.data={},n.initialText=null,n.rng=n.tiny.selection.getRng(),n.selectedElm=n.tiny.selection.getNode(),n.anchorElm=n.tiny.dom.getParent(n.selectedElm,"a[href]"),n.onlyText=n.isOnlyTextSelected(),n.data.text=n.initialText=n.anchorElm?n.anchorElm.innerText||n.anchorElm.textContent:n.tiny.selection.getContent({format:"text"}),n.data.href=n.anchorElm?n.tiny.dom.getAttrib(n.anchorElm,"href"):"",n.anchorElm?n.data.target=n.tiny.dom.getAttrib(n.anchorElm,"target"):n.tiny.options.get("link_default_target")&&(n.data.target=n.tiny.options.get("link_default_target")),(t=n.tiny.dom.getAttrib(n.anchorElm,"rel"))&&(n.data.rel=t),(t=n.tiny.dom.getAttrib(n.anchorElm,"class"))&&(n.data.class=t),(t=n.tiny.dom.getAttrib(n.anchorElm,"title"))&&(n.data.title=t),n.tiny.focus(),n.anchorElm=n.dom.getParent(n.selectedElm,"a[href]"),n.isImageMode()){var i;i=n.selectedElm,n.imgElm=i;var a=n.dom.getAttrib(n.imgElm,"src"),l=n.dom.getAttrib(n.imgElm,"data-captiontext");if(n.$title.val(n.dom.getAttrib(n.imgElm,"title")),n.$alt.val(n.dom.getAttrib(n.imgElm,"alt")),r()(n.imgElm).hasClass("zoomable")&&n.$enableImageZoom.prop("checked",!0),r()(n.imgElm).hasClass("captioned")&&!l?(n.$captionFromDescription.prop("checked",!0),n.$caption.prop("disabled",!0)):(r()(n.imgElm).hasClass("captioned"),n.$captionFromDescription.prop("checked",!1)),l&&n.$caption.val(l),(e=n.dom.getAttrib(n.imgElm,"data-linktype"))&&e in n.linkTypes){n.linkType=e,n.linkTypes[n.linkType].load(n.imgElm);var o=n.dom.getAttrib(n.imgElm,"data-picturevariant");n.$scale.val(o),r()("#tinylink-"+n.linkType,n.modal.$modal).trigger("click")}else a&&n.guessImageLink(a);for(var s=n.dom.getAttrib(n.imgElm,"class").split(" "),c=0;c<s.length;c+=1){var m=s[c];for(var p in n.options.imageClasses)-1!==p.indexOf(m)&&n.$align.val(m)}}else if(n.anchorElm){n.focusElement(n.anchorElm);var d;if(d=n.dom.getAttrib(n.anchorElm,"href"),n.$target.val(n.dom.getAttrib(n.anchorElm,"target")),n.$title.val(n.dom.getAttrib(n.anchorElm,"title")),e=n.dom.getAttrib(n.anchorElm,"data-linktype")){n.linkType=e,n.linkTypes[n.linkType].load(n.anchorElm);var h=r()("#tinylink-"+n.linkType,n.modal.$modal);1===h.length&&r()("#"+h.data("autotoc-trigger-id")).trigger("click")}else d&&n.guessAnchorLink(d)}},guessImageLink:function(t){-1!==t.indexOf(this.options.prependToScalePart)?(this.linkType="image",this.$scale.val(this.tinypattern.getScaleFromUrl(t)),this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(t))):(this.linkType="externalImage",this.linkTypes.externalImage.set(t))},guessAnchorLink:function(t){if(console.log("href: "+t),this.options.prependToUrl&&-1!==t.indexOf(this.options.prependToUrl))this.linkType="internal",this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(t));else if(-1!==t.indexOf("mailto:")){this.linkType="email";var e=t.substring(7,t.length).split("?subject=");this.linkTypes.email.set(e[0]),e.length>1&&this.$subject.val(decodeURIComponent(e[1]))}else"#"===t[0]?(this.linkType="anchor",this.linkTypes.anchor.set(t.substring(1))):(this.linkType="external",this.linkTypes.external.set(t))},reinitialize:function(){this.modal.options.html=this.generateModalHtml()}})}}]);
//# sourceMappingURL=48357.331eafb9246526e60a61.min.js.map